<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <title>一个人最了不起的成就，就是找到自己</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <style>
        html,
        body {
            margin: 0;
            padding: 0;
            background-color: black;
        }

        .background {
            position: absolute;
            display: block;
            top: 0;
            left: 0;
            z-index: 0;
        }

        #text {
            font-size: 100px;
            color: red;
            text-align: center;
            z-index: 9;
        }
        #from {
            font-size: 50px;
            color: red;
            text-align: right;
            z-index: 9;
        }

        .snow,
        .snow:before,
        .snow:after {
            position: absolute;
            top: -600px;
            left: 0;
            bottom: 0;
            right: 0;
            background-image: radial-gradient(5px 5px at 81px 465px, white 50%, rgba(0, 0, 0, 0)), radial-gradient(4px 4px at 429px 473px, rgba(255, 255, 255, 0.6) 50%, rgba(0, 0, 0, 0)), radial-gradient(5px 5px at 363px 322px, rgba(255, 255, 255, 0.6) 50%, rgba(0, 0, 0, 0)), radial-gradient(6px 6px at 582px 144px, rgba(255, 255, 255, 0.7) 50%, rgba(0, 0, 0, 0)), radial-gradient(5px 5px at 169px 361px, rgba(255, 255, 255, 0.7) 50%, rgba(0, 0, 0, 0)), radial-gradient(6px 6px at 102px 185px, rgba(255, 255, 255, 0.7) 50%, rgba(0, 0, 0, 0)), radial-gradient(6px 6px at 197px 366px, rgba(255, 255, 255, 0.8) 50%, rgba(0, 0, 0, 0)), radial-gradient(4px 4px at 22px 55px, rgba(255, 255, 255, 0.9) 50%, rgba(0, 0, 0, 0)), radial-gradient(5px 5px at 231px 577px, rgba(255, 255, 255, 0.7) 50%, rgba(0, 0, 0, 0)), radial-gradient(3px 3px at 53px 142px, rgba(255, 255, 255, 0.6) 50%, rgba(0, 0, 0, 0)), radial-gradient(5px 5px at 324px 203px, rgba(255, 255, 255, 0.6) 50%, rgba(0, 0, 0, 0)), radial-gradient(4px 4px at 252px 410px, rgba(255, 255, 255, 0.9) 50%, rgba(0, 0, 0, 0)), radial-gradient(5px 5px at 576px 201px, white 50%, rgba(0, 0, 0, 0)), radial-gradient(5px 5px at 139px 396px, rgba(255, 255, 255, 0.8) 50%, rgba(0, 0, 0, 0)), radial-gradient(6px 6px at 216px 362px, rgba(255, 255, 255, 0.8) 50%, rgba(0, 0, 0, 0)), radial-gradient(4px 4px at 192px 519px, white 50%, rgba(0, 0, 0, 0)), radial-gradient(3px 3px at 439px 90px, rgba(255, 255, 255, 0.9) 50%, rgba(0, 0, 0, 0)), radial-gradient(5px 5px at 69px 573px, rgba(255, 255, 255, 0.8) 50%, rgba(0, 0, 0, 0)), radial-gradient(6px 6px at 440px 534px, rgba(255, 255, 255, 0.8) 50%, rgba(0, 0, 0, 0)), radial-gradient(4px 4px at 84px 15px, rgba(255, 255, 255, 0.9) 50%, rgba(0, 0, 0, 0)), radial-gradient(3px 3px at 274px 30px, rgba(255, 255, 255, 0.8) 50%, rgba(0, 0, 0, 0)), radial-gradient(5px 5px at 221px 159px, rgba(255, 255, 255, 0.6) 50%, rgba(0, 0, 0, 0)), radial-gradient(4px 4px at 530px 394px, rgba(255, 255, 255, 0.6) 50%, rgba(0, 0, 0, 0)), radial-gradient(5px 5px at 390px 536px, rgba(255, 255, 255, 0.6) 50%, rgba(0, 0, 0, 0)), radial-gradient(3px 3px at 561px 44px, white 50%, rgba(0, 0, 0, 0)), radial-gradient(6px 6px at 489px 359px, rgba(255, 255, 255, 0.7) 50%, rgba(0, 0, 0, 0)), radial-gradient(4px 4px at 456px 175px, rgba(255, 255, 255, 0.7) 50%, rgba(0, 0, 0, 0)), radial-gradient(5px 5px at 573px 447px, white 50%, rgba(0, 0, 0, 0)), radial-gradient(6px 6px at 309px 418px, white 50%, rgba(0, 0, 0, 0)), radial-gradient(6px 6px at 273px 99px, rgba(255, 255, 255, 0.8) 50%, rgba(0, 0, 0, 0)), radial-gradient(6px 6px at 366px 532px, rgba(255, 255, 255, 0.8) 50%, rgba(0, 0, 0, 0)), radial-gradient(3px 3px at 94px 518px, white 50%, rgba(0, 0, 0, 0)), radial-gradient(3px 3px at 363px 187px, rgba(255, 255, 255, 0.8) 50%, rgba(0, 0, 0, 0)), radial-gradient(6px 6px at 357px 93px, rgba(255, 255, 255, 0.8) 50%, rgba(0, 0, 0, 0)), radial-gradient(3px 3px at 512px 581px, rgba(255, 255, 255, 0.6) 50%, rgba(0, 0, 0, 0)), radial-gradient(4px 4px at 340px 273px, rgba(255, 255, 255, 0.6) 50%, rgba(0, 0, 0, 0)), radial-gradient(5px 5px at 533px 165px, rgba(255, 255, 255, 0.8) 50%, rgba(0, 0, 0, 0)), radial-gradient(6px 6px at 274px 278px, white 50%, rgba(0, 0, 0, 0)), radial-gradient(3px 3px at 483px 95px, rgba(255, 255, 255, 0.8) 50%, rgba(0, 0, 0, 0)), radial-gradient(6px 6px at 59px 75px, rgba(255, 255, 255, 0.6) 50%, rgba(0, 0, 0, 0)), radial-gradient(5px 5px at 542px 335px, rgba(255, 255, 255, 0.6) 50%, rgba(0, 0, 0, 0)), radial-gradient(5px 5px at 188px 165px, rgba(255, 255, 255, 0.9) 50%, rgba(0, 0, 0, 0)), radial-gradient(3px 3px at 457px 441px, rgba(255, 255, 255, 0.7) 50%, rgba(0, 0, 0, 0)), radial-gradient(6px 6px at 69px 272px, rgba(255, 255, 255, 0.7) 50%, rgba(0, 0, 0, 0)), radial-gradient(4px 4px at 396px 482px, rgba(255, 255, 255, 0.8) 50%, rgba(0, 0, 0, 0)), radial-gradient(3px 3px at 209px 357px, rgba(255, 255, 255, 0.9) 50%, rgba(0, 0, 0, 0)), radial-gradient(3px 3px at 153px 479px, rgba(255, 255, 255, 0.8) 50%, rgba(0, 0, 0, 0)), radial-gradient(5px 5px at 86px 10px, rgba(255, 255, 255, 0.6) 50%, rgba(0, 0, 0, 0)), radial-gradient(5px 5px at 482px 39px, rgba(255, 255, 255, 0.8) 50%, rgba(0, 0, 0, 0)), radial-gradient(3px 3px at 588px 368px, white 50%, rgba(0, 0, 0, 0)), radial-gradient(6px 6px at 536px 248px, rgba(255, 255, 255, 0.7) 50%, rgba(0, 0, 0, 0)), radial-gradient(5px 5px at 297px 234px, rgba(255, 255, 255, 0.7) 50%, rgba(0, 0, 0, 0)), radial-gradient(4px 4px at 162px 343px, rgba(255, 255, 255, 0.7) 50%, rgba(0, 0, 0, 0)), radial-gradient(6px 6px at 118px 358px, white 50%, rgba(0, 0, 0, 0)), radial-gradient(5px 5px at 225px 214px, white 50%, rgba(0, 0, 0, 0)), radial-gradient(3px 3px at 162px 486px, rgba(255, 255, 255, 0.8) 50%, rgba(0, 0, 0, 0)), radial-gradient(3px 3px at 359px 46px, rgba(255, 255, 255, 0.6) 50%, rgba(0, 0, 0, 0)), radial-gradient(5px 5px at 455px 559px, white 50%, rgba(0, 0, 0, 0)), radial-gradient(6px 6px at 208px 305px, rgba(255, 255, 255, 0.9) 50%, rgba(0, 0, 0, 0)), radial-gradient(4px 4px at 292px 89px, rgba(255, 255, 255, 0.6) 50%, rgba(0, 0, 0, 0)), radial-gradient(5px 5px at 453px 257px, rgba(255, 255, 255, 0.8) 50%, rgba(0, 0, 0, 0)), radial-gradient(6px 6px at 407px 542px, rgba(255, 255, 255, 0.7) 50%, rgba(0, 0, 0, 0)), radial-gradient(6px 6px at 90px 488px, rgba(255, 255, 255, 0.8) 50%, rgba(0, 0, 0, 0)), radial-gradient(4px 4px at 499px 340px, rgba(255, 255, 255, 0.7) 50%, rgba(0, 0, 0, 0)), radial-gradient(6px 6px at 50px 111px, white 50%, rgba(0, 0, 0, 0)), radial-gradient(6px 6px at 130px 14px, rgba(255, 255, 255, 0.8) 50%, rgba(0, 0, 0, 0)), radial-gradient(5px 5px at 537px 289px, white 50%, rgba(0, 0, 0, 0)), radial-gradient(5px 5px at 12px 515px, rgba(255, 255, 255, 0.9) 50%, rgba(0, 0, 0, 0)), radial-gradient(3px 3px at 516px 593px, rgba(255, 255, 255, 0.9) 50%, rgba(0, 0, 0, 0)), radial-gradient(5px 5px at 305px 370px, rgba(255, 255, 255, 0.6) 50%, rgba(0, 0, 0, 0));
            background-size: 600px 600px;
            animation: snow 3s linear infinite;
            content: "";
        }

        .snow:after {
            margin-left: -200px;
            opacity: 0.4;
            animation-duration: 6s;
            animation-direction: reverse;
            filter: blur(3px);
        }

        .snow:before {
            animation-duration: 9s;
            animation-direction: reverse;
            margin-left: -300px;
            opacity: 0.65;
            filter: blur(1.5px);
        }

        @keyframes snow {
            to {
                transform: translateY(600px);
            }
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/particlesjs@2.2.3/dist/particles.min.js"></script>
</head>

<body>
    <p id="text"></p>
    <p id="from"></p>

    <canvas class="background"></canvas>
    <audio></audio>
    <script>
        var synth = window.speechSynthesis;
        console.log(synth.getVoices());
        voices = synth.getVoices().filter(v => v['lang'] == 'zh-CN');
        console.log(voices);

        function speak(text) {
            if (synth.speaking) {
                console.error('speechSynthesis.speaking');
                return;
            }
            if (text !== '') {
                var utterThis = new SpeechSynthesisUtterance(text);
                utterThis.onend = function (event) {
                    fetch();
                    console.log('SpeechSynthesisUtterance.onend');
                }
                utterThis.onerror = function (event) {
                    setTimeout(() => {
                        fetch();
                    }, 5000);
                    console.error('SpeechSynthesisUtterance.onerror');
                }
                utterThis.voice = voices[Math.floor(Math.random() * voices.length)];
                utterThis.pitch = 1;
                utterThis.rate = 1;
                synth.speak(utterThis);
            }
        }

        function change(text) {
            console.log(text);
            var json = JSON.parse(text);
            document.querySelector('#text').innerText = json["hitokoto"];
            if(json['from_who']) {
                document.querySelector('#from').innerText = json['from'] + " - " + json['from_who'];
            } else {
                document.querySelector('#from').innerText = json['from'] + "  ";
            }
            return json['hitokoto'];
            // speak(json['hitokoto']);
        }
        function fetch() {
            console.log('fetch');
            var xhr = new XMLHttpRequest();
            xhr.open("GET", "https://v1.hitokoto.cn/");
            xhr.onload = function () {
                var text = change(xhr.response);
                setTimeout(() => {fetch();}, Math.max(2000, text.length * 200));
            }
            xhr.send();
            
        }
        function setSpeech() {
            return new Promise(
                function (resolve, reject) {
                    let id;
                    id = setInterval(() => {
                        if (synth.getVoices().length !== 0) {
                            resolve(synth.getVoices().filter(v => v['lang'] == 'zh-CN'));
                            clearInterval(id);
                        }
                    }, 10);
                }
            )
        }
        window.onload = function () {
            calendar = new Date();
            month = calendar.getMonth();
            date = calendar.getDate();
            if (((month == 11) && (date == 24)) || ((month == 11) && (date == 25))) {
                let snow = document.createElement("div");
                snow.className = 'snow';
                let currentDiv = document.getElementById("text");
                document.body.insertBefore(snow,currentDiv);
            } else {
                Particles.init({
                    selector: '.background',
                    connectParticles: true,
                    color: "#9eff76",
                    minDistance: 160
                });
            }
            fetch();

            function playAudio() {
                var srcs = ['my sweetest one.mp3'];
                var audio = document.querySelector('audio');
                audio.src = srcs[Math.floor(Math.random() * srcs.length)];
                audio.play();
                audio.addEventListener('ended', () => {playAudio();});
            }
            document.body.addEventListener('click', ()=>{
                playAudio();
            });
            document.body.addEventListener('keyup', (event) => {
                if(event.code == 'Space') {
                    console.log("Space key up");
                    window.location = 'https://liuping.win/nes.html';
                }
            })
        };
    </script>

</body>